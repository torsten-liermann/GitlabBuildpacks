deploy:docker:
  image: "$CNCF_BUILDER_IMAGE"
  stage: push
  extends: [ ".registry-auth-for-docker" ]
  artifacts:
    name: "report"
    paths:
      - report.toml
  cache: []
  script:
    - /cnb/lifecycle/creator -platform ./platform -log-level debug -app . -cache-image $IMAGE_NAME/paketo-build-cache $IMAGE_NAME

cleanup_pipelinecache:
# Irgendein Image mit user "root", damit der Cache als "root" behandelt werden kann.
  image: $DOCKER_IMAGE
  stage: .post
  when: always
  allow_failure: true
  variables:
    GIT_STRATEGY: none
  script:
    - rm -f /cache/$CI_PROJECT_PATH/build-$CI_PIPELINE_ID-protected/cache.zip || true
    - echo "empty file" > cnb.tgz || true
